input {
	redis {
		host => [${REDIS_HOST:"redis-logging.default.svc.cluster.local"}]
		data_type => "list"
		key => "logstash"
		type => "redis-input"
	}
}

filter {
	
	grok{
		match => {
			"message" => "%{GREEDYDATA:label}, \[%{TIMESTAMP_ISO8601:timestamp} #%{NUMBER:id}\]  %{LOGLEVEL:level} -- : %{GREEDYDATA:message}"
		}
		overwrite => ["message"]
		add_tag => ["rails"]
	}

	grok {
		match => {
			"message" => "%{LOGLEVEL:severity}: %{YEAR:year}/%{MONTHNUM:month}/%{MONTHDAY:day} %{TIME:time} %{GREEDYDATA:message}"
		}
		overwrite => ["message"]
		add_tag => ["golang"]
	}

	mutate {
		remove_tag => ["_grokparsefailure"]
	}
}

output {
	elasticsearch {
		hosts => [${ELASTICSEARCH_URL:"elasticsearch-logging"}]
	}
	stdout {
		codec => rubydebug
	}
}
